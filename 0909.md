
# 9th Sep

## Traffic Generator

- firewall
  - cheap
- traffic generator is expensive
  - why? bought by corporates, to test firewall
- GAN
  - generative adversarial network
- hping3 traffic generator
  - icmp, udp, flood
  - probably no 3 way
- iperf
  - important for testing rate limiting rules
  - rate limiting , shows the rate server receives
  - 2 side testing while hping3 is one sideicon
  - has 3way handshake

## TCP replay

- `tcpreplay -i eth0 -t traffic.pcap`
- `tcpreplay -i eth0 -x 2 -t traffic.pcap`
- `tcpreplay -i eth0 -K --mbps=10 traffic.pcap`
  - why skipping packets?
    - the tcp queue gets full and router drops
  - when replaying, is there 3 way handshake?
- why even after the firewall setting(iptables), was there some ICMP packaets seen in victims?

## Traffic Regulation

| iptables | tc | snort | swicate? | cisco/fortinet|
| --------------- | --------------- | --------------- | --------------- |---|
| Item1.1 | Item2.1 | opensource | opensource | |

- terabytes per second speed for ISPs -> checkings give substantial latency
  - solution: specialised hardware: ASIC
  - feed iptable by burning, and run those checks to traffic
  - no flexibility(can only burn once)
  - very expensive
- solution - FPGA -> fully programmable gate array?
  - configurable, but fast
  - current research topic
  - uses specific language like E4

## Iptables

```bash
iptables -A INPUT -p icmp -j DROP
iptables -A INPUT -s attacker_ip -j DROP
iptables -A INPUT -p tcp --dport 80 -j DROP

```

- rate limiting

```bash
iptables -A INPUT -p tcp --syn -m limit --limit 1/s -j ACCEPT
iptables -A INPUT -p tcp --syn -j DROP
```

- signature based

```bash
iptables -A INPUT -m string --algo bm --string"malware" -j DROP
iptables -A INPUT -p tcp --dport 80 -m string --algo bm --string "Nmap" -j DROP
```

- conntrack

```bash
iptables -A INPUT -m conntrack --ctate INVALID -j DROP
iptables -A INPUT -p tcp --syn -m conntrack --ctstate NEW -m limit --limit 10/s -j ACCEPT
iptables -A INPUT -p tcp --syn -j DROP
```

- new, established, related, invaild
- invalid is when a tcp connection (like ack ) was unexpected.
  - firewall likely should drop it.
- why do we limite only the rate? not the size? can't hacker just use large few loads?
  - tcp maintains states, for each connection. so many connections runs out memory
  - for os, page swap happens, crashes memory
- Tracking sources and blocking them

```bash
iptables -A INPUT -p tcp --dport22 -m recent --set --name SSH
iptables -A INPUT -p tcp --dport22 -m recent --update --seconds 60 --hitcount 10 --name SSH -j DROP
```

- can bypass with delay, but defense goal saved
- doesn't keep timestamp
- why not just use a rate limiting?
  - no, this is more specific.
